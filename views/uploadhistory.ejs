<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Upload History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    <section class="">
      <div class="center">
        <%- include('./catalogHeader', { user }) %>
      </div>
      
    </section>

      <div class="mb-4"></div>

<div class="container mt-4">

  <% if (files.length==0) { %>

    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        No Uploaded History!!!
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>

  <% for (let rowIndex = 0; rowIndex < files.length; rowIndex += 3) { %>
    <!-- Row -->
    <div class="row justify-content-center mb-4">
      <% for (let colIndex = rowIndex; colIndex < rowIndex + 3 && colIndex < files.length; colIndex++) { %>
        <!-- Column -->
        <div class="col-md-4 d-flex justify-content-center">
          <!-- Product Card -->
          <div class="card shadow-sm fixed-card">
            <!-- Cover Photo or Placeholder -->
            <% if (files[colIndex].cover_photo) { %>
              <img src="<%= files[colIndex].cover_photo %>" class="card-img-top" alt="Cover Photo" style="object-fit: contain; width: 100%; height: 225px; background-color: #f8f9fa;">

            <% } else { %>
              <svg class="bd-placeholder-img card-img-top" width="100%" height="225" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: thumbnail" preserveAspectRatio="xMidYMid slice" focusable="false">
                <title>Placeholder</title>
                <rect width="100%" height="100%" fill="#55595c"></rect>
                <text x="50%" y="50%" fill="#eceeef" dy=".3em" text-anchor="middle">Thumbnail</text>
              </svg>
            <% } %>

            <div class="card-body">
              <h5 class="card-title"><%= files[colIndex].product_name %></h5>
              <p class="card-text"><%= files[colIndex].description %></p>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Price: $<%= files[colIndex].price %></li>
                <li class="list-group-item">Location: <%= files[colIndex].location %></li>
                <li class="list-group-item">Contact: <%= files[colIndex].contact_number %></li>
                <li class="list-group-item"><a 
                    href="/update-status/<%= files[colIndex].product_id %>?currentStatus=<%= files[colIndex].status %>" 
                    class="btn <%= files[colIndex].status ? 'btn-success' : 'btn-danger' %>">
                    <%= files[colIndex].status ? 'The Product is now set as "Available" -- Click here to mark as "Not Available" ' :  'The Product is now set as "Not Available" -- Click here to mark as "Available" ' %>
                  </a></li>
              </ul>
              <div class="d-flex justify-content-between align-items-center mt-3">
                <button 
                  class="btn btn-primary" 
                  data-bs-toggle="modal" 
                  data-bs-target="#modal-<%= colIndex %>">
                  View More Photos
                </button>
                <small class="text-muted">Uploaded: <%= files[colIndex].created_at %></small>
              </div>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  <% } %>
</div>

<!-- Modals -->
<% files.forEach((file, index) => { %>
  <div class="modal fade" id="modal-<%= index %>" tabindex="-1" aria-labelledby="modalLabel<%= index %>" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalLabel-<%= index %>"><%= file.product_name %></h5>

          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Bootstrap Carousel -->
          <div id="carousel-<%= index %>" class="carousel slide" data-bs-ride="carousel">
            <!-- Carousel Indicators -->
            <div class="carousel-indicators">
              <% for (let i = 0; i < file.other_photos.length + 1; i++) { %>
                <button type="button" data-bs-target="#carousel-<%= index %>" data-bs-slide-to="<%= i %>" class="<%= i === 0 ? 'active' : '' %>" aria-current="<%= i === 0 ? 'true' : '' %>" aria-label="Slide <%= i + 1 %>"></button>
              <% } %>
            </div>
            <!-- Carousel Inner -->
            <div class="carousel-inner">
              <!-- Cover Photo -->
              <div class="carousel-item active">
                <img src="<%= file.cover_photo %>" class="d-block w-100" alt="Cover Photo">
              </div>
              <!-- Additional Photos -->
              <% for (let i = 0; i < file.other_photos.length; i++) { %>
                <div class="carousel-item">
                  <img src="<%= file.other_photos[i] %>" class="d-block w-100" alt="Additional Photo <%= i + 1 %>">
                </div>
              <% } %>
            </div>
            <!-- Carousel Controls -->
            <button class="carousel-control-prev" type="button" data-bs-target="#carousel-<%= index %>" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carousel-<%= index %>" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
<% }) %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>